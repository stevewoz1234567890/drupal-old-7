window.addEventListener("load",function(){window.cookieconsent.initialise({palette:{popup:{background:"#ffffff",text:"#191919"},button:{background:"#ffffff",text:"#191919"}},theme:"edgeless",content:{message:'We use cookies and other tracking technologies to enhance your browsing experience. If you continue to use our site, you agree to the use of such cookies. For more info, see our <a href="https://www.thisamericanlife.org/page/privacy-policy">privacy policy</a>.',dismiss:"",link:!1,href:"https://www.thisamericanlife.org/page/privacy-policy"}})}),function($){$.fn.matchHeight._maintainScroll=!0,$(document).ready(function(){$("body").addClass("loaded")}),Drupal.behaviors.thislife={attach:function(){}},Drupal.behaviors.thislifePlayer={attach:function(){var e=$("body"),a=$("#site-header"),t=$("#burger"),n=$("#main"),i=$("#sidebar"),o=$("#top"),l=$("#jplayer"),s=$("#player"),r=s.find(".jp-progress"),d=s.find("#player-info"),p=$("#share-modal"),f=$("#player-share-modal"),c=0,u=!1,y=!1,h=!1,m=0,v=window.location.pathname+window.location.search,w=$(window),g=0,b=0,k=!1,C=function(){var e=w.width(),a=e>=1024?"desktop":e>=768?"tablet":"mobile";return a},j=C(),P=function(){g=w.scrollTop(),D(),window.requestAnimationFrame(P)},D=function(){!k&&g>0?(k=!0,e.addClass("scrolled")):k&&0>=g&&(k=!1,e.removeClass("scrolled"))},K=function(e){var a=h,t=0;$("a.play-act").removeClass("playing"),d.find(".title").html("").hide(),m="undefined"!=typeof e?e:0,"undefined"!=typeof h.acts&&$.each(h.acts,function(e,a){a.number===m&&(t=a.timestamp,d.find(".title").html(a.name).css("display","inline-block"))}),l.jPlayer("play",t),$("a.play-"+h.episode+"-"+m).addClass("playing")},x=function(e){var a=h,t=0;$("a.playing").removeClass("playing"),d.find(".episode").html(a.title),d.find(".image").html($("<img/>").attr("src",a.thumbnail)),d.find(".title").html("").hide(),r.find(".jump").remove(),m="undefined"!=typeof e?e:0,"undefined"!=typeof h.acts&&$.each(h.acts,function(e,a){a.number===m&&(t=a.timestamp,d.find(".title").html(a.name).css("display","inline-block"))}),l.jPlayer("setMedia",{mp3:a.audio}).jPlayer("play",t),$("a.play-"+h.episode+"-"+m).addClass("playing")},E=function(){g=w.scrollTop(),b=w.height(),j=C()},_=function(){$(".contextual-links-wrapper").find("a").addClass("ignore"),$("a.shareout").once("links").addClass("external").on("click",function(e){var a=new CustomEvent("talGoto",{detail:{type:"external",url:$(this).prop("href"),ctrlKey:e.ctrlKey,metaKey:e.metaKey}});window.dispatchEvent(a),l.length&&e.preventDefault()}),p.find("a.close").once("links").addClass("ignore").on("click",function(a){a.preventDefault(),e.removeClass("open-share")}),$("a.share").once("links").addClass("ignore").on("click",function(a){a.preventDefault(),e.addClass("open-share")}),f.find("a.close").once("links").addClass("ignore").on("click",function(a){a.preventDefault(),e.removeClass("open-player-share")}),$("a.player-share").once("links").addClass("ignore").on("click",function(a){a.preventDefault(),e.addClass("open-player-share")}),$('a[href]:not([href*="'+window.location.hostname+'"]):not([href^="#"]):not([href^="/"]):not([href^="javascript:"]):not([href^="mailto:"]):not(.cut)').once("links").addClass("external").on("click",function(e){var a=new CustomEvent("talGoto",{detail:{type:"external",url:$(this).prop("href"),ctrlKey:e.ctrlKey,metaKey:e.metaKey}});window.dispatchEvent(a),l.length&&e.preventDefault()}),$("a.external").once("links").on("click",function(e){var a=new CustomEvent("talGoto",{detail:{type:"external",url:$(this).prop("href"),ctrlKey:e.ctrlKey,metaKey:e.metaKey}});window.dispatchEvent(a),l.length&&e.preventDefault()}),$('a[href*="'+window.location.hostname+'"],[href^="/"]').not(".goto, .play, .ignore").once("links").addClass("internal").on("click",function(e){var a=new CustomEvent("talGoto",{detail:{type:"internal",url:$(this).prop("href"),ctrlKey:e.ctrlKey,metaKey:e.metaKey}});window.dispatchEvent(a),l.length&&e.preventDefault()}),$(".node-episode").once("links").each(function(){var e={type:$(this).data("type"),id:$(this).data("id"),episode:$(this).data("episode")};$(this).on("click.special","a.goto-episode",function(a){e.url=$(this).prop("href"),e.ctrlKey=a.ctrlKey,e.metaKey=a.metaKey;var t=new CustomEvent("talGoto",{detail:e});window.dispatchEvent(t),l.length&&a.preventDefault()})});var a=$("ul.actions");a.find("a.download").off("click").on("click.download",function(e){e.preventDefault()}),$("a.cut").attr("target","_blank"),a.on("click.shortcut","a.cut",function(e){var a=new CustomEvent("talShortcut",{detail:{type:$(this).data("type"),id:$(this).data("id"),url:$(this).prop("href")}});window.dispatchEvent(a)}),$("a.play").off("click").on("click.play",function(a){if(a.preventDefault(),$(this).hasClass("playing"))l.jPlayer("pause");else{if(!e.hasClass("player")&&e.hasClass("node-type-homepage")){var t=new CustomEvent("talGoto",{detail:{type:"internal",url:$(this).prop("href")}});window.dispatchEvent(t)}var t=new CustomEvent("talPlay",{detail:{type:$(this).data("type"),id:$(this).data("id"),episode:$(this).data("episode"),act:$(this).data("act")}});window.dispatchEvent(t)}})},T=function(){_(),Drupal.behaviors.contextualLinks.attach(),Drupal.behaviors.thislifeHeight.attach(),Drupal.behaviors.thislifeAbout.attach(),Drupal.behaviors.thislifeExtras.attach(),"undefined"!=typeof h&&(u?($("a.play-"+h.episode+"-"+m).addClass("playing"),$("a.play-"+h.episode).addClass("playing")):($("a.play-act").removeClass("playing"),$("a.play-"+h.episode).removeClass("playing")))},S=function(t,l,s){var r=t.split("#"),d=r[0],f=r[1],c=0;if("/"===d[0])if(v===d)if(o.removeClass("disabled"),f&&$("#"+f).length){var u=$("#"+f).offset().top;$("html, body").animate({scrollTop:u},0)}else $("html, body").animate({scrollTop:0},0);else{"undefined"==typeof s&&"/archive"===v.substring(0,8)&&$saved_archive.html(n.html()).data({path:v,scroll:g});var y=Drupal.settings.basePath+"goto"+d;"/"===d&&(y+="?type=json"),$.ajax({url:y,cache:!0,data:l,dataType:"json",error:function(){window.open(d,"_self")},success:function(l){if(v=d,window.history.pushState&&(s?window.history.replaceState({path:d},"",d):window.history.pushState({path:d},"",d)),o.empty(),i.empty(),"undefined"!=typeof s&&s&&"/archive"===t.substring(0,8)&&$saved_archive.html()&&$saved_archive.data("path")===t?($saved_archive.data("scroll")&&(c=$saved_archive.data("scroll")),n.html($saved_archive.html()),n.find(".links-processed").removeClass("links-processed"),$saved_archive.empty().removeData("scroll path")):n.html(l.main),"undefined"!=typeof l.sidebar&&i.html(l.sidebar),"undefined"!=typeof l.top&&o.html(l.top),"undefined"!=typeof l.color?a.css("background-color",l.color):a.css("background-color",""),$nav.find("li.active-trail").removeClass("active-trail"),$nav.find("a.active").removeClass("active"),open_menu=!1,e.removeClass("open-menu player-open"),"undefined"!=typeof l.facebook&&p.find("a.facebook").attr("href",l.facebook),"undefined"!=typeof l.twitter&&p.find("a.twitter").attr("href",l.twitter),"undefined"!=typeof l.mail&&p.find("a.mail").attr("href",l.mail),f&&"keyword"===f&&$("#edit-keyword").length)$("#edit-keyword").focus();else if(f&&$("#"+f).length){var r=$("#"+f).offset().top;$("html, body").animate({scrollTop:r},0)}else $("html, body").animate({scrollTop:c},0);var u=$("body").attr("class").split(" ");if($.each(u,function(e,a){0===a.indexOf("page-")&&$("body").removeClass(a),0===a.indexOf("node-")&&$("body").removeClass(a)}),"undefined"!=typeof l.node_type&&$("body").addClass("node-type-"+l.node_type),"undefined"!=typeof l.section){$("body").addClass("page-"+l.section),isNaN(l.section)||$("body").addClass("page-episode-number-"+l.section);var y=l.section;"listen"===y&&(y="how-to-listen"),$nav.find("li."+y).addClass("active-trail")}$("title").text(l.title),T()}})}};if(_(),$(window).on("load",function(){E()}).on("throttledresize",function(){E()}),E(),window.requestAnimationFrame(P),l.length){var G,M=function(){if("undefined"!=typeof G){var e={fingerprint:G,episode:h.episode,position:c,source:"thisamericanlife"};$.ajax({url:"https://hb.serialpodcast.org/",data:e})}};(new Fingerprint2).get(function(e){G=e}),l.jPlayer({ready:function(){y=!0},timeupdate:function(e){var a=parseInt(e.jPlayer.status.currentTime),t=Math.floor(e.jPlayer.status.duration),n=0;"undefined"!=typeof h.acts&&$.each(h.acts,function(e,t){a>=t.timestamp&&(n=t.number)}),n!==m&&($("a.play-act").removeClass("playing"),"undefined"!=typeof h.acts&&$.each(h.acts,function(e,a){a.number===n&&(m=a.number,d.find(".title").html(a.name).css("display","inline-block"),"undefined"!=typeof a.byline?d.find(".contributor").html(a.byline):d.find(".contributor").empty(),"undefined"!=typeof a.summary?d.find(".body").html(a.summary):d.find(".body").empty(),_())}),$("a.play-"+h.episode+"-"+m).addClass("playing")),t>60&&a%1===0&&a>c+14&&(c=a,M());var i=e.jPlayer.status;$(".jp-remaining").text($.jPlayer.convertTime(i.duration-i.currentTime))},play:function(){u=!0,$("body").addClass("player playing"),$("a.play-"+h.episode+"-"+m).addClass("playing"),$("a.play-"+h.episode).addClass("playing")},pause:function(){$("body").removeClass("playing"),u=!1,$("a.play-act").removeClass("playing"),$("a.play-"+h.episode).removeClass("playing")},loadeddata:function(e){var a=e.jPlayer.status.duration;"undefined"!=typeof h.acts&&$.each(h.acts,function(e,t){if(t.number>0){var n=$("<a/>").addClass("jump").css({left:t.timestamp/a*100+"%"}).on("click",function(){l.jPlayer("play",t.timestamp)});r.append(n)}})},ended:function(){u=!1,$("body").removeClass("playing"),c=0},swfPath:jplayer_swfPath,wmode:"window"}),s.find("a.cut").on("click",function(e){if(e.preventDefault(),typeof h!==!1&&"undefined"!=typeof h.episode){var a="https://shortcut.thisamericanlife.org/#/clipping/"+h.episode;if(l.data("jPlayer").status.currentTime){var t=Math.floor(l.data("jPlayer").status.currentTime);a+="/"+t}l.jPlayer("pause"),window.open(a,"_blank")}}),$(window).on("talGoto",function(a){var t=a.originalEvent.detail;"undefined"!=typeof t.ctrlKey&&t.ctrlKey||"undefined"!=typeof t.metaKey&&t.metaKey?window.open(t.url,"_blank"):e.hasClass("page-broadcast")?window.open(t.url,"_blank"):e.hasClass("page-status-404-not-found")?window.open(t.url,"_self"):e.hasClass("page-heartbeat")?window.open(t.url,"_self"):"external"===t.type?window.open(t.url,"_blank"):window.open(t.url,"welcome")}),$(window).bind("popstate",function(){var e=window.location.pathname+window.location.search;S(e,{},!0)}),$(window).on("talPlay",function(e){var a=e.originalEvent.detail;if("undefined"!=typeof a.type)if($("body").addClass("player"),"episode"===a.type){if("undefined"!=typeof a.episode)if(typeof h===!1||h.episode!==a.episode)if($("#playlist-data").length){var t=JSON.parse($("#playlist-data").html());h=t,"undefined"!=typeof t.facebook&&f.find("a.facebook").attr("href",t.facebook),"undefined"!=typeof t.twitter&&f.find("a.twitter").attr("href",t.twitter),"undefined"!=typeof t.mail&&f.find("a.mail").attr("href",t.mail),x()}else{var n=$("#playlist-data-"+a.episode);if(n.length){var t=JSON.parse(n.html());h=t,"undefined"!=typeof t.facebook&&f.find("a.facebook").attr("href",t.facebook),"undefined"!=typeof t.twitter&&f.find("a.twitter").attr("href",t.twitter),"undefined"!=typeof t.mail&&f.find("a.mail").attr("href",t.mail),x()}}else l.jPlayer("play")}else if("act"===a.type&&"undefined"!=typeof a.episode)if(typeof h===!1||h.episode!==a.episode){if($("#playlist-data").length){var t=JSON.parse($("#playlist-data").html());h=t,"undefined"!=typeof t.facebook&&f.find("a.facebook").attr("href",t.facebook),"undefined"!=typeof t.twitter&&f.find("a.twitter").attr("href",t.twitter),"undefined"!=typeof t.mail&&f.find("a.mail").attr("href",t.mail),x(a.act)}}else a.act!==m?K(a.act):l.jPlayer("play")}),s.on("click","a, .jp-progress",function(e){e.stopPropagation()}),s.on("click","a.close",function(){e.removeClass("player-open")}),s.find("a.jp-rewind").click(function(e){if(e.preventDefault(),y){var a=Math.floor(l.data("jPlayer").status.currentTime)-10;0>a&&(a=0),l.jPlayer("play",a)}}),s.find("a.jp-forward").click(function(e){if(e.preventDefault(),y){var a=Math.floor(l.data("jPlayer").status.currentTime)+30;a<l.data("jPlayer").status.duration&&l.jPlayer("play",a)}}),s.find("a.jp-previous").click(function(e){if(e.preventDefault(),y&&h&&"undefined"!=typeof h.acts){var a=Math.floor(l.data("jPlayer").status.currentTime),t=h.acts.slice().reverse();$.each(t,function(e,t){return t.number<=m&&t.timestamp<a?(l.jPlayer("play",t.timestamp),!1):void 0})}}),s.find("a.jp-next").click(function(e){if(e.preventDefault(),y&&h&&"undefined"!=typeof h.acts){var a=Math.floor(l.data("jPlayer").status.currentTime);$.each(h.acts,function(e,t){return t.number>m&&t.timestamp>a?(l.jPlayer("play",t.timestamp),!1):void 0})}}),s.on("click",function(){"mobile"===j&&(e.hasClass("player-open")||e.addClass("player-open"))})}n.on("click","a.pager",function(e){e.preventDefault();var a=$(this),t=$(this).attr("href");$.ajax({url:t,cache:!0,dataType:"json",success:function(e){var n=a.parents("ul.pager").parent(".item-list");n.replaceWith(e.html),window.history.pushState&&window.history.replaceState({path:t},"",e.path),Drupal.behaviors.thislifeHeight.attach(),_(),"undefined"!=typeof ga&&ga("send","pageview",{page:t,title:e.title})}})})}},Drupal.behaviors.thislifeHeight={attach:function(){$("#main").find(".node.view-teaser").matchHeight()}}}(jQuery);