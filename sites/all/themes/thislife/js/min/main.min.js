window.addEventListener("load",function(){void 0!==window.cookieconsent&&window.cookieconsent.initialise({palette:{popup:{background:"#ffffff",text:"#191919"},button:{background:"#ffffff",text:"#191919"}},theme:"edgeless",content:{message:'We use cookies and other tracking technologies to enhance your browsing experience. If you continue to use our site, you agree to the use of such cookies. For more info, see our <a href="https://www.thisamericanlife.org/page/privacy-policy">privacy policy</a>.',dismiss:"",link:!1,href:"https://www.thisamericanlife.org/page/privacy-policy"}})});var isMobile={Android:function(){return!(!navigator.userAgent.match(/Android/i)||"undefined"==typeof AndroidInterface)},iOS:function(){return!(!navigator.userAgent.match(/iPhone|iPad|iPod/i)||void 0===window.webkit||void 0===window.webkit.messageHandlers)}};isMobile.Android()&&(document.body.classList.add("android"),window.addEventListener("talPlay",function(e){AndroidInterface.talPlay(JSON.stringify(e.detail))}),window.addEventListener("talGoto",function(e){AndroidInterface.talGoto(JSON.stringify(e.detail))})),/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform)&&document.body.classList.add("ios"),isMobile.iOS()&&(window.addEventListener("talPlay",function(e){window.webkit.messageHandlers.talPlay.postMessage(JSON.stringify(e.detail))}),window.addEventListener("talGoto",function(e){var detail=e.detail,path=detail.url;"/"===path[0]&&(detail.url="https://"+window.location.hostname+path),window.webkit.messageHandlers.talGoto.postMessage(JSON.stringify(detail))})),function($){$.fn.matchHeight._maintainScroll=!0,$(document).ready(function(){$("body").addClass("loaded")}),Drupal.behaviors.thislife={attach:function(){}},Drupal.behaviors.thislifePlayer={attach:function(){var $body=$("body"),$header=$("#site-header"),$burger=$("#burger"),$nav=$("#main-menu"),$saved_archive=$("#saved-archive"),open_menu=!1;$nav.on("click",function(e){e.stopPropagation()}),$burger.on("click",function(e){e.preventDefault(),e.stopPropagation(),open_menu?(open_menu=!1,$body.removeClass("open-menu")):(open_menu=!0,$body.addClass("open-menu"))}),function(){try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}}()&&$body.swipe({swipeRight:function(){open_menu&&(open_menu=!1,$body.removeClass("open-menu"))},threshold:20}),$header.on("click",".scrim",function(e){open_menu&&(open_menu=!1,$body.removeClass("open-menu"),e.preventDefault(),e.stopPropagation())});var $eyebrow=$("#eyebrow");$eyebrow.length&&(void 0===Cookies.get("eyebrow")&&$body.addClass("open-eyebrow"),$eyebrow.on("click","a.close",function(e){e.preventDefault(),$body.removeClass("open-eyebrow"),Cookies.set("eyebrow",!0,{expires:7})}));var $main=$("#main"),$sidebar=$("#sidebar"),$top=$("#top"),$jp=$("#jplayer"),$player=$("#player"),$progress=$player.find(".jp-progress"),$info=$player.find("#player-info"),$share_modal=$("#share-modal"),$player_share_modal=($("#subscribe-modal"),$("#player-share-modal")),last_position=0,playing=!1,ready=!1,current_episode=!1,current_act=0,last_path=window.location.pathname+window.location.search,$window=$(window),scrollTop=0,scrolled=!1,adOffsets=[],viewSize=function(){var width=$window.width(),newview=width>=1024?"desktop":width>=768?"tablet":"mobile",classes=$body.attr("class").split(" ");return $.each(classes,function(i,c){0===c.indexOf("view-")&&$body.removeClass(c)}),$body.addClass("view-"+newview),newview},view=viewSize(),updatePage=function(){scrollTop=$window.scrollTop(),animateElements(),window.requestAnimationFrame(updatePage)},animateElements=function(){!scrolled&&scrollTop>0?(scrolled=!0,$body.addClass("scrolled")):scrolled&&scrollTop<=0&&(scrolled=!1,$body.removeClass("scrolled"))},playEpisode=function(act){adOffsets=[];var immediate=void 0===act||0===act,goPlay=function(act){var data=current_episode,current_timestamp=0;$("a.play").removeClass("playing"),$info.find(".episode").html(data.title),$info.find(".image").html($("<img/>").attr("src",data.thumbnail)),$info.find(".title").html("").hide(),$progress.find(".jump").remove(),current_act=void 0!==act?act:0,void 0!==current_episode.acts&&$.each(current_episode.acts,function(i,act){act.number===current_act&&(current_timestamp=act.timestamp,$info.find(".title").html(act.name).css("display","inline-block"))}),$jp.jPlayer("setMedia",{mp3:data.audio}).jPlayer("play",current_timestamp),$("a.play-"+current_episode.episode+", a.play-"+current_episode.episode+"-"+current_act).addClass("playing"),"undefined"!=typeof ga&&ga("send","event","Play source",current_episode.episode,last_path)};if(immediate&&goPlay(act),void 0!==current_episode.simplecast&&void 0===current_episode.timings){var url=current_episode.simplecast.replace(/https:\/\/[^.]*\.podtrac\.com\/(pts\/)?redirect\.mp3\//,"https://"),http=new XMLHttpRequest;http.open("HEAD",url,!0),http.onreadystatechange=function(){if(this.readyState==this.DONE){var status=http.status;if(status>=200&&status<400)if(void 0===this.responseURL)goPlay(),$body.addClass("no-acts");else if(this.responseURL){var urlSplit=this.responseURL.split("?");$.ajax({cache:!1,url:"https://nyt.simplecastaudio.com/metadata?"+urlSplit[1],success:function(data){current_episode.timings=data;var timings=data.split("\n").slice(2);for(i=0;i<=timings.length;i+=2){var timing=timings[i];if(timing){var length=timings[i+1].match(/durationMilliseconds=(\d+)/)[1];adOffsets.push({offset:timing/1e3,length:length/1e3}),void 0!==current_episode.acts&&$.each(current_episode.acts,function(act){current_episode.acts[act].timestamp>timing/1e3&&(void 0===current_episode.acts[act].timestamp_original&&(current_episode.acts[act].timestamp_original=current_episode.acts[act].timestamp),current_episode.acts[act].timestamp+=Math.floor(length/1e3))})}}immediate||goPlay(act)}})}else goPlay(),$body.addClass("no-acts");else goPlay(),$body.addClass("no-acts")}},http.send()}else void 0!==current_episode.dovetail&&void 0===current_episode.timings?$.ajax({url:current_episode.dovetail+"?noImp&timings",dataType:"json",success:function(data){current_episode.timings=data,current_episode.length=[];var ad_length=0;$.each(data.types,function(i){var type=data.types[i],delta=data.timings[i+1]-data.timings[i];current_episode.length.push(delta),"original"!==type?(ad_length+=delta,void 0!==current_episode.acts&&$.each(current_episode.acts,function(act){(0===act&&current_episode.acts[act].timestamp>=data.timings[i+1]||0!==act&&current_episode.acts[act].timestamp>=data.timings[i+1]-ad_length)&&(void 0===current_episode.acts[act].timestamp_original&&(current_episode.acts[act].timestamp_original=current_episode.acts[act].timestamp),current_episode.acts[act].timestamp+=delta)})):ad_length=0}),immediate||goPlay(act)}}):immediate||goPlay(act)},initArchive=function(){var $form=$("#tal-episode-browse-form");if($form.length){var $top=$("#top"),$body=$("body"),$modals=$form.find(".modal"),$options=$form.find("#browse-options"),$selects=$form.find(".form-wrapper-select"),$type_sort=$("#type-sort"),dirty=($form.find(".filters"),!1),active=!0;$top.removeClass("disabled"),$type_sort.on("click",function(e){"desktop"!==view&&($type_sort.hasClass("open")||(e.preventDefault(),e.stopPropagation(),$type_sort.addClass("open")))}),$body.on("click",function(e){$type_sort.hasClass("open")&&($type_sort.removeClass("open"),e.preventDefault())}),$form.find("a.options").on("click",function(e){e.preventDefault(),$top.addClass("open-filters")}),$options.on("click","a.close",function(e){e.preventDefault(),$top.removeClass("open-filters")}),$options.on("click","a.modal",function(e){e.preventDefault();var target=$(this).attr("href"),$target=$(target);$top.addClass("open-modals"),$target.show()}),$options.find("a.modal").each(function(){var $option=$(this),element=$(this).data("element"),$element=$form.find("."+element).find("select");$option.on("click",function(e){$option.hasClass("selected")&&(e.preventDefault(),e.stopPropagation(),$option.removeClass("selected").find(".selection .value").text(""),$element.val(0),dirty||(dirty=!0,$form.addClass("dirty"),$form.submit()),$top.removeClass("open-filters open-modals"))})}),$modals.each(function(){var $modal=$(this),id=$modal.attr("id"),$option=$options.find("."+id),$select_wrapper=$selects.filter("."+id),$alpha_nav=$modal.find(".alpha-nav");$modal.find(".alpha");$modal.on("click","header a",function(e){e.preventDefault(),$modal.hide(),$top.removeClass("open-modals")}),$alpha_nav.on("click","a",function(e){var href=$(this).attr("href"),$anchor=$(href);e.preventDefault(),e.stopPropagation(),$modal.find(".inner > .item-list").animate({scrollTop:$anchor.position().top},250)}),$modal.on("click",".inner a",function(e){e.preventDefault();var value=$(this).data("value"),key=$(this).data("key"),element=$(this).data("element");$form.find("."+element).find("select").val(key),$option.addClass("selected").find(".selection .value").text(value),$select_wrapper.addClass("selected").find(".selection .value").text(value),dirty=!0,$form.addClass("dirty"),"desktop"===view?$form.submit():($modal.hide(),$top.removeClass("open-modals"))})}),$selects.each(function(){var $select=$(this);$select.on("click","label",function(e){if(e.preventDefault(),$select.hasClass("selected"))e.stopPropagation(),$select.find("select").val(0),$form.submit();else{var target=$select.data("target"),$target=$("#"+target);$top.addClass("open-modals"),$target.show()}})}),$form.on("submit",function(e){e.preventDefault(),active&&(active=!1,$top.removeClass("open-filters open-modals").addClass("disabled"),$modals.hide(),$.ajax({url:$(this).attr("action"),type:$(this).attr("method"),dataType:"json",data:$(this).serialize(),success:function(data){$top.removeClass("open-modals"),gotoPath(data.redirect)}}))})}},resizePage=function(){scrollTop=$window.scrollTop(),$window.height(),view=viewSize()},initLinks=function(){$(".contextual-links-wrapper").find("a").addClass("ignore"),$("a.shareout").once("links").addClass("external").on("click",function(e){var event=new CustomEvent("talGoto",{detail:{type:"external",url:$(this).prop("href"),ctrlKey:e.ctrlKey,metaKey:e.metaKey}});window.dispatchEvent(event),$jp.length&&e.preventDefault()}),$('a[href]:not([href*="'+window.location.hostname+'"]):not([href^="#"]):not([href^="/"]):not([href^="javascript:"]):not([href^="mailto:"]):not(.cut)').once("links").addClass("external").on("click",function(e){var event=new CustomEvent("talGoto",{detail:{type:"external",url:$(this).prop("href"),ctrlKey:e.ctrlKey,metaKey:e.metaKey}});window.dispatchEvent(event),$jp.length&&e.preventDefault()}),$("a.external").once("links").on("click",function(e){var event=new CustomEvent("talGoto",{detail:{type:"external",url:$(this).prop("href"),ctrlKey:e.ctrlKey,metaKey:e.metaKey}});window.dispatchEvent(event),$jp.length&&e.preventDefault()}),$('a[href*="'+window.location.hostname+'"],[href^="/"]').not(".goto, .play, .ignore").once("links").addClass("internal").on("click",function(e){var event=new CustomEvent("talGoto",{detail:{type:"internal",url:$(this).prop("href"),ctrlKey:e.ctrlKey,metaKey:e.metaKey}});window.dispatchEvent(event),$jp.length&&e.preventDefault()}),$(".node-episode").once("links").each(function(){var detail={type:$(this).data("type"),id:$(this).data("id"),episode:$(this).data("episode")};$(this).on("click.special","a.goto-episode",function(e){detail.url=$(this).prop("href"),detail.ctrlKey=e.ctrlKey,detail.metaKey=e.metaKey;var event=new CustomEvent("talGoto",{detail:detail});window.dispatchEvent(event),$jp.length&&e.preventDefault()})}),$(".node-transcript").once("links").each(function(){var $node=$(this);$(this).on("click.special","a.goto-episode",function(e){var detail={type:"episode",id:$node.data("episode-id"),episode:$node.data("episode"),url:$(this).prop("href")};detail.ctrlKey=e.ctrlKey,detail.metaKey=e.metaKey;var event=new CustomEvent("talGoto",{detail:detail});window.dispatchEvent(event),$jp.length&&e.preventDefault()})}),$(".node-pick").once("links").each(function(){var detail={type:$(this).data("type"),id:$(this).data("id")};$(this).on("click.special","a.goto-collection",function(e){detail.url=$(this).prop("href"),detail.ctrlKey=e.ctrlKey,detail.metaKey=e.metaKey;var event=new CustomEvent("talGoto",{detail:detail});window.dispatchEvent(event),$jp.length&&e.preventDefault()}),$(this).on("click.special","a.goto-act, a.goto-episode",function(e){var $act=$(this),detail={type:$act.data("type"),id:$act.data("id"),episode:$act.data("episode"),url:$(this).prop("href")};detail.ctrlKey=e.ctrlKey,detail.metaKey=e.metaKey;var event=new CustomEvent("talGoto",{detail:detail});window.dispatchEvent(event),$jp.length&&e.preventDefault()})}),$(".node-act").once("links").each(function(){var $act=$(this);$(this).on("click.special","a.goto-act",function(e){var detail={type:$act.data("type"),id:$act.data("id"),episode:$act.data("episode"),url:$(this).prop("href")};detail.url=$(this).prop("href"),detail.ctrlKey=e.ctrlKey,detail.metaKey=e.metaKey;var event=new CustomEvent("talGoto",{detail:detail});window.dispatchEvent(event),$jp.length&&e.preventDefault()}),$(this).on("click.special","a.goto-episode",function(e){var detail={type:"episode",id:$act.data("episode-id"),episode:$act.data("episode"),url:$(this).prop("href")};detail.ctrlKey=e.ctrlKey,detail.metaKey=e.metaKey;var event=new CustomEvent("talGoto",{detail:detail});window.dispatchEvent(event),$jp.length&&e.preventDefault()})}),$(".node-collection").once("links").each(function(){var detail={type:$(this).data("type"),id:$(this).data("id")};$(this).on("click.special","a.goto-collection",function(e){detail.url=$(this).prop("href"),detail.ctrlKey=e.ctrlKey,detail.metaKey=e.metaKey;var event=new CustomEvent("talGoto",{detail:detail});window.dispatchEvent(event),$jp.length&&e.preventDefault()})}),$("ul.actions").find("a.download").off("click").on("click.download",function(e){e.preventDefault()}),$("a.play").off("click").on("click.play",function(e){if(e.preventDefault(),$(this).hasClass("playing"))$jp.jPlayer("pause");else{if(!$body.hasClass("player")&&$body.hasClass("node-type-homepage")){var event=new CustomEvent("talGoto",{detail:{type:"internal",url:$(this).prop("href")}});window.dispatchEvent(event)}event=new CustomEvent("talPlay",{detail:{type:$(this).data("type"),id:$(this).data("id"),episode:$(this).data("episode"),act:$(this).data("act")}});window.dispatchEvent(event),$(this).hasClass("play-transcript")&&($body.addClass("has-closed-caption"),"undefined"!=typeof ga&&ga("send","event","Play transcript",current_episode.episode,last_path))}}),$("a.js-closed-caption").off("click").on("click.closed-caption",function(e){$body.hasClass("has-closed-caption")?$body.removeClass("has-closed-caption"):($body.addClass("has-closed-caption"),"undefined"!=typeof ga&&ga("send","event","CC button",current_episode.episode,last_path))})},gotoPath=function(url,data,replace){var split=url.split("#"),path=split[0],fragment=split[1],scrollTo=0;if($body.removeClass("has-closed-caption"),"/"===path[0])if(last_path===path)if($top.removeClass("disabled"),fragment&&$("#"+fragment).length){var offset=$("#"+fragment).offset().top;$("html, body").animate({scrollTop:offset},0)}else $("html, body").animate({scrollTop:0},0);else{void 0===replace&&"/archive"===last_path.substring(0,8)&&$saved_archive.html($main.html()).data({path:last_path,scroll:scrollTop});var goto_path=Drupal.settings.basePath+"goto"+path;"/"===path&&(goto_path+="?type=json"),$.ajax({url:goto_path,cache:!0,data:data,dataType:"json",error:function(){window.open(path,"_self")},success:function(data){if(last_path=path,window.history.pushState&&(replace?window.history.replaceState({path:path},"",path):window.history.pushState({path:path},"",path)),$top.empty(),$sidebar.empty(),void 0!==replace&&replace&&"/archive"===url.substring(0,8)&&$saved_archive.html()&&$saved_archive.data("path")===url?($saved_archive.data("scroll")&&(scrollTo=$saved_archive.data("scroll")),$main.html($saved_archive.html()),$main.find(".links-processed").removeClass("links-processed"),$saved_archive.empty().removeData("scroll path")):$main.html(data.main),void 0!==data.sidebar&&$sidebar.html(data.sidebar),void 0!==data.top&&$top.html(data.top),void 0!==data.color?$header.css("background-color",data.color):$header.css("background-color",""),$nav.find("li.active-trail").removeClass("active-trail"),$nav.find("a.active").removeClass("active"),open_menu=!1,$body.removeClass("open-menu player-open"),void 0!==data.facebook&&$share_modal.find("a.facebook").attr("href",data.facebook),void 0!==data.twitter&&$share_modal.find("a.twitter").attr("href",data.twitter),void 0!==data.mail&&$share_modal.find("a.mail").attr("href",data.mail),fragment&&"keyword"===fragment&&$("#edit-keyword").length)$("#edit-keyword").focus();else if(fragment&&$("#"+fragment).length){var offset=$("#"+fragment).offset().top;$("html, body").animate({scrollTop:offset},0)}else $("html, body").animate({scrollTop:scrollTo},0);var classes=$("body").attr("class").split(" ");if($.each(classes,function(i,c){0===c.indexOf("page-")&&$("body").removeClass(c),0===c.indexOf("node-")&&$("body").removeClass(c)}),void 0!==data.node_type&&$("body").addClass("node-type-"+data.node_type),void 0!==data.section){$("body").addClass("page-"+data.section),isNaN(data.section)||$("body").addClass("page-episode-number-"+data.section);var section=data.section;"listen"===section&&(section="how-to-listen"),$nav.find("li."+section).addClass("active-trail")}$("title").text(data.title),initLinks(),initArchive(),Drupal.behaviors.contextualLinks.attach(),Drupal.behaviors.thislifeHeight.attach(),Drupal.behaviors.thislifeAbout.attach(),Drupal.behaviors.thislifeExtras.attach(),void 0!==current_episode&&(playing?$("a.play-"+current_episode.episode+", a.play-"+current_episode.episode+"-"+current_act).addClass("playing"):$("a.play").removeClass("playing")),"undefined"!=typeof ga&&ga("send","pageview",{page:path,title:data.title})}})}};if(initLinks(),initArchive(),$window.on("load",function(){resizePage(),$body.addClass("is-loaded")}).on("throttledresize",function(){resizePage()}),resizePage(),window.requestAnimationFrame(updatePage),$jp.length){if((new Fingerprint2).get(function(result){result}),$jp.jPlayer({ready:function(){ready=!0},timeupdate:function(event){var position=parseInt(event.jPlayer.status.currentTime),new_total=Math.floor(event.jPlayer.status.duration),new_act=0;void 0!==current_episode.acts&&$.each(current_episode.acts,function(i,act){position>=act.timestamp&&(new_act=act.number)}),new_act!==current_act&&($("a.play-act").removeClass("playing"),void 0!==current_episode.acts&&$.each(current_episode.acts,function(i,act){act.number===new_act&&(current_act=act.number,$info.find(".title").html(act.name).css("display","inline-block"),void 0!==act.byline?$info.find(".contributor").html(act.byline):$info.find(".contributor").empty(),void 0!==act.summary?$info.find(".body").html(act.summary):$info.find(".body").empty(),initLinks())}),$("a.play-"+current_episode.episode+", a.play-"+current_episode.episode+"-"+current_act).addClass("playing")),new_total>60&&position%1==0&&position>last_position+14&&(last_position=position);var status=event.jPlayer.status;if($(".jp-remaining").text($.jPlayer.convertTime(status.duration-status.currentTime)),$body.hasClass("node-type-transcript")){var $node=$(".node-transcript.view-full");if($node.data("episode")==current_episode.episode){var $content=$node.find(".content");$paragraphs=$content.find("p").removeClass("is-current"),last_paragraph=0,$paragraphs.each(function(i){var timestamp=$(this).data("timestamp");if($.each(adOffsets,function(i){timestamp>adOffsets[i].offset&&(timestamp+=adOffsets[i].length)}),!(position>=timestamp))return!1;last_paragraph=i}),$paragraphs;var $current_paragraph=$paragraphs.eq(last_paragraph).addClass("is-current");if($body.hasClass("has-closed-caption")){var offset=$current_paragraph.offset().top-parseInt($body.css("padding-top"),10)-parseInt($node.css("padding-top"),10)-80;$("html, body").animate({scrollTop:offset},250)}}}},play:function(){playing=!0,$("body").addClass("player playing"),$("a.play-"+current_episode.episode+", a.play-"+current_episode.episode+"-"+current_act).addClass("playing")},pause:function(){playing=!1,$("body").removeClass("playing"),$("a.play").removeClass("playing")},loadeddata:function(event){var duration=event.jPlayer.status.duration;void 0!==current_episode.acts&&$.each(current_episode.acts,function(i,act){if(act.number>0){var $jump=$("<a/>").addClass("jump").css({left:act.timestamp/duration*100+"%"}).on("click",function(){$jp.jPlayer("play",act.timestamp)});$progress.append($jump)}})},ended:function(){playing=!1,$("body").removeClass("playing"),last_position=0},swfPath:jplayer_swfPath,wmode:"window"}),$body.hasClass("node-type-embed")){var $target=$("#playlist-data");if($target.length){var data=JSON.parse($target.html());$body.on("click",".embed__play",function(e){e.preventDefault(),$jp.jPlayer("setMedia",{mp3:data.audio}).jPlayer("play")})}}$player.on("click","a.player-transcript",function(e){e.preventDefault(),!1!==typeof current_episode&&void 0!==current_episode.transcript&&($body.hasClass("has-closed-caption")?$body.removeClass("has-closed-caption"):(gotoPath(current_episode.transcript),$body.addClass("has-closed-caption"),"undefined"!=typeof ga&&ga("send","event","CC button",current_episode.episode,last_path)))}),$(window).on("talGoto",function(e){var detail=e.originalEvent.detail;if(void 0!==detail.ctrlKey&&detail.ctrlKey||void 0!==detail.metaKey&&detail.metaKey)window.open(detail.url,"_blank");else if($body.hasClass("page-broadcast"))window.open(detail.url,"_blank");else if($body.hasClass("page-status-404-not-found"))window.open(detail.url,"_self");else if($body.hasClass("page-heartbeat"))window.open(detail.url,"_self");else if("external"===detail.type)window.open(detail.url,"_blank");else{var path=detail.url;"/"!==path[0]&&(path=(path=path.replace("http://"+window.location.hostname+(location.port?":"+location.port:""),"")).replace("https://"+window.location.hostname+(location.port?":"+location.port:""),"")),path.match(/^\/(user|admin|system|heartbeat)/i)?window.open(detail.url,"_self"):"/"===path[0]&&gotoPath(path)}}),$(window).bind("popstate",function(){var path=window.location.pathname+window.location.search;gotoPath(path,{},!0)}),$(window).on("talPlay",function(e){var act,current_timestamp,detail=e.originalEvent.detail;if(void 0!==detail.type)if($("body").addClass("player"),"episode"===detail.type){if(void 0!==detail.episode)if(!1===typeof current_episode||current_episode.episode!==detail.episode){var $target=$("#playlist-data");if($("#playlist-data-"+detail.episode).length&&($target=$("#playlist-data-"+detail.episode)),$target.length){var data=JSON.parse($target.html());current_episode=data,void 0!==data.facebook&&$player_share_modal.find("a.facebook").attr("href",data.facebook),void 0!==data.twitter&&$player_share_modal.find("a.twitter").attr("href",data.twitter),void 0!==data.mail&&$player_share_modal.find("a.mail").attr("href",data.mail),playEpisode()}}else $jp.jPlayer("play")}else if("act"===detail.type){if(void 0!==detail.episode)if(!1===typeof current_episode||current_episode.episode!==detail.episode){$target=$("#playlist-data");if($("#playlist-data-"+detail.episode).length&&($target=$("#playlist-data-"+detail.episode)),$target.length){data=JSON.parse($target.html());current_episode=data,void 0!==data.facebook&&$player_share_modal.find("a.facebook").attr("href",data.facebook),void 0!==data.twitter&&$player_share_modal.find("a.twitter").attr("href",data.twitter),void 0!==data.mail&&$player_share_modal.find("a.mail").attr("href",data.mail),playEpisode(detail.act)}}else detail.act!==current_act?(act=detail.act,current_timestamp=0,$("a.play").removeClass("playing"),$info.find(".title").html("").hide(),current_act=void 0!==act?act:0,void 0!==current_episode.acts&&$.each(current_episode.acts,function(i,act){act.number===current_act&&(current_timestamp=act.timestamp,$info.find(".title").html(act.name).css("display","inline-block"))}),$jp.jPlayer("play",current_timestamp),$("a.play-"+current_episode.episode+", a.play-"+current_episode.episode+"-"+current_act).addClass("playing")):$jp.jPlayer("play")}else if("extra"===detail.type&&$("#playlist-data").length){data=JSON.parse($("#playlist-data").html());current_episode=data,void 0!==data.facebook&&$player_share_modal.find("a.facebook").attr("href",data.facebook),void 0!==data.twitter&&$player_share_modal.find("a.twitter").attr("href",data.twitter),void 0!==data.mail&&$player_share_modal.find("a.mail").attr("href",data.mail),playEpisode()}}),$player.on("click","a, .jp-progress",function(e){e.stopPropagation()}),$player.on("click","a.close",function(){$body.removeClass("player-open")}),$player.find("a.jp-rewind").click(function(e){if(e.preventDefault(),ready){var new_time=Math.floor($jp.data("jPlayer").status.currentTime)-10;new_time<0&&(new_time=0),$jp.jPlayer("play",new_time)}}),$player.find("a.jp-forward").click(function(e){if(e.preventDefault(),ready){var new_time=Math.floor($jp.data("jPlayer").status.currentTime)+30;new_time<$jp.data("jPlayer").status.duration&&$jp.jPlayer("play",new_time)}}),$player.find("a.jp-previous").click(function(e){if(e.preventDefault(),ready&&current_episode&&void 0!==current_episode.acts){var time=Math.floor($jp.data("jPlayer").status.currentTime),acts=current_episode.acts.slice().reverse();$.each(acts,function(i,act){if(act.number<=current_act&&act.timestamp<time)return $jp.jPlayer("play",act.timestamp),!1})}}),$player.find("a.jp-next").click(function(e){if(e.preventDefault(),ready&&current_episode&&void 0!==current_episode.acts){var time=Math.floor($jp.data("jPlayer").status.currentTime);$.each(current_episode.acts,function(i,act){if(act.number>current_act&&act.timestamp>time)return $jp.jPlayer("play",act.timestamp),!1})}}),$player.on("click",function(){"mobile"===view&&($body.hasClass("player-open")||$body.addClass("player-open"))})}$main.on("click","a.pager",function(e){e.preventDefault();var $a=$(this),path=$(this).attr("href");$.ajax({url:path,cache:!0,dataType:"json",success:function(data){$a.parents("ul.pager").parent(".item-list").replaceWith(data.html),window.history.pushState&&window.history.replaceState({path:path},"",data.path),Drupal.behaviors.thislifeHeight.attach(),initLinks(),"undefined"!=typeof ga&&ga("send","pageview",{page:path,title:data.title})}})})}},Drupal.behaviors.thislifeAbout={attach:function(){var $menu=$("#block-tal-about-menu");($menu.length&&($menu.on("click",function(e){e.preventDefault(),$menu.toggleClass("open")}),$menu.on("click",".content",function(e){e.stopPropagation()}),$menu.on("click","a",function(){$menu.removeClass("open")})),$("body").hasClass("page-about-announcements"))&&$("#main").find(".node-announcement").slice(0,2).matchHeight()}},Drupal.behaviors.thislifeExtras={attach:function(){if($("body").hasClass("node-type-gallery")){var $node=$("#main").find(".node-gallery"),$gallery_slideshow=$node.find("#gallery-slideshow"),$gallery_slides=$gallery_slideshow.find(".gallery-slide"),$gallery_images=$node.find("figure.file-image"),gallery_slide_template=$node.find("#gallery-slide-template").html(),current_slide=0,total_slides=$gallery_images.length,$window=$(window),window_width=$window.width(),caption_offset=0,reset_caption_offset=function(){$gallery_slides.removeClass("offset").find(".meta > .inner").removeAttr("style"),caption_offset=$gallery_slides.eq(current_slide).find(".meta > .inner").position(),$gallery_slides.addClass("offset").find(".meta > .inner").css("top",caption_offset.top)};$(window).on("load",function(){window_width=$window.width()}).on("throttledresize",function(){var new_width=$window.width();new_width<1024&&($gallery_slideshow.hide(),$gallery_slides.hide()),window_width=new_width,reset_caption_offset()}),$gallery_images.each(function(i){var $gallery_image=$(this),slide_data={color:$node.data("background"),img:$gallery_image.find("img").attr("src"),width:$gallery_image.find("img").attr("width"),height:$gallery_image.find("img").attr("height"),current:i+1,total:total_slides,caption:$gallery_image.find("figcaption").html()},slide=Mustache.to_html(gallery_slide_template,slide_data);$gallery_slideshow.append(slide),$gallery_image.on("click",function(e){window_width>=1024&&(e.preventDefault(),current_slide=i,$gallery_slides.eq(i).show(),$gallery_slideshow.show(),reset_caption_offset())})}),$gallery_slides=$gallery_slideshow.find(".gallery-slide"),$gallery_slideshow.on("click","button.close",function(e){e.preventDefault(),$gallery_slideshow.hide(),$gallery_slides.hide()}),$gallery_slideshow.on("click","button.prev",function(e){e.preventDefault();var new_slide=current_slide-1;new_slide<0&&(new_slide=total_slides-1),$gallery_slides.hide(),$gallery_slides.eq(new_slide).show(),current_slide=new_slide}),$gallery_slideshow.on("click","button.next",function(e){e.preventDefault();var new_slide=current_slide+1;new_slide>=total_slides&&(new_slide=0),$gallery_slides.hide(),$gallery_slides.eq(new_slide).show(),current_slide=new_slide}),$(document).keydown(function(e){switch(e.keyCode){case 37:(new_slide=current_slide-1)<0&&(new_slide=total_slides-1),$gallery_slides.hide(),$gallery_slides.eq(new_slide).show(),current_slide=new_slide;break;case 39:var new_slide;(new_slide=current_slide+1)>=total_slides&&(new_slide=0),$gallery_slides.hide(),$gallery_slides.eq(new_slide).show(),current_slide=new_slide;break;case 27:$gallery_slideshow.hide(),$gallery_slides.hide()}})}}},Drupal.behaviors.thislifeHeight={attach:function(){if($("body").hasClass("page-archive")&&$("#main").find(".node.view-teaser").matchHeight(),$("body").hasClass("node-type-video-collection")&&$("#main").find(".node-video.view-collection .content").matchHeight(),$("body").hasClass("node-type-homepage")){var $featured=$("#main").find(".node-homepage").find(".featured");$featured.length&&$featured.find(".node.view-featured .inner").matchHeight()}}}}(jQuery);
